## Snakr

A URL shortener service demo using Python and [Flask micro framework](http://flask.pocoo.org)
on GAE with a Google Cloud SQL backend.

## Test It Online
1. Install curl or another REST client testing tool like [Advanced Rest Client Application for Chrome](https://chrome.google.com/webstore/detail/advanced-rest-client/hgmloofddffdnphfgcellkdfbfbjeloo/reviews?hl=en-US&utm_source=ARC)

2. Using your REST testing tool, test the POST action:
    ```
    URL: http://premium-fuze-120323.appspot.com
    POST:
        Content-Type: application/json
        Payload:      {"u":"<the url you want to shorten goes here without the angle brackets>"}
    ```

3. Using your browser, curl or the tool, test the GET action:
    ```
    URL: <the short url generated by the POST step above>
    ```

## Install and Run
1. Install the [App Engine Python SDK](https://developers.google.com/appengine/downloads).
See the README file for directions. You'll need python 2.7 and [pip 1.4 or later](http://www.pip-installer.org/en/latest/installing.html) installed too.

2. Clone this repo with

   ```
   git clone https://github.com/bretlowery/snakr.git
   ```
3. Install dependencies in the project's lib directory.
   Note: App Engine can only import libraries from inside your project directory.

   ```
   cd snakr
   pip install -r requirements.txt -t lib
   ```
4. Create your GAE and Cloud SQL instances.

5. Upload from your Python IDE to GAE.

6. Create an instance in Cloud SQL to hold the database.

7. Create a user account in SQL to install the database such as "dbo" with a password. Do NOT use the sql "root" login and
do NOT change its existing password. GAE will use root@localhost to connect to Cloud SQL on the back end.

8. In your browser, visit WhatIsMyIP.com. Get your local IP address, and over in the Cloud SQL admin page, grant your IP access to
your SQL instance. This allows you to connect from your local machine. If your local IP changes, you will not be able to connect
from your local MySQL Workbench client until you grant your new IP acesss on the Cloud SQL admin page.

9. Install [MySQL Workbench](https://www.mysql.com/downloads) and connect to Cloud SQL using:
*Host = the Coud SQL IP (not your local one, the one of the Cloud SQL instance
*Port = the default 3306 MySQL port
*Username = "dbo", or the username you created
*Password = the password you entered
*Database/Scheme = the db/scheme name you entered

10. In MySQL Workbench, run Install.sql to create the db objects.

11. In Globals.py, adjust these parameters accordingly:

Setting               | Value
--------------------- | ------------------------------
detailed_errors       | True of False. If True, returns detailed error messages if any occur to the caller.
user_error            | If detailed_errors = False, this string is returned on any error. HTTP 1xx/3xx/4xx/5xx errors are handled normally.
server                | Your Google App Engine id. snakr test is 'premium-fuze-120323'.
webroot               | The HTTP schema and netloc/host/domain to append to the short URLs generated; i.e., your web server.
schema                | Name of your Cloud SQL schema (database).
instance              | DO NOT ALTER THIS ENTRY WHEN HOSTING ON GAE.
unix_socket           | DO NOT ALTER THIS ENTRY WHEN HOSTING ON GAE.
charset               | Your mySQL character set, defaults to 'utf8'
short_urlsize         | How many characters in the 'shorten_using' alphabet to use in building short URLs.
shorten_using         | The alphabet containing the characters from which to build the short URL.
max_collision_retries | The maximum number of retries to attempt before returning an error should a hashing collision occur.

### Installing Libraries
See the [Third party libraries](https://developers.google.com/appengine/docs/python/tools/libraries27)
page for libraries that are already included in the SDK.  To include SDK
libraries, add them in your app.yaml file. Other than libraries included in
the SDK, only pure python libraries may be added to an App Engine project.

## Author
Bret Lowery
